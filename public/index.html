<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Voice listener and recorder with voiceCmdr</title>
  </head>
  <body>
    <p>Say: "Go [something]".</p>

    <p id="received">Received command: <span id="something"></span>
      <!--<span><img id="listening" src="images/sound-graph-static.jpg"></span> -->
    </p>
    <p>Inserted: <span id="result"></span></p>
    <p id="me">Search String: <span id="search"></span></p>
    <p id="speech">Stored Speech:
      <table>
        <tbody id="tbody"></tbody>
      </table>
    </p>

    <script src="js/voiceCmdr.js"></script>
    <script src="js/jquery-2.1.3.min.js"></script>
    <script src="js/app.js"></script>
    <script>
      $('#received').on('change','#listening', function() {
        $("#listening").attr("src", voiceCmdr.isRecognizing() ? 'images/sound-graph-listening.gif' : 'images/sound-graph-static.jpg');
      });
      $('#me').on('search','#search', function() {
        var getting = $.get('/api/snippets/content=' + $('#search').text());
        getSnippets(getting);
      });
    </script>
    <script>
      // table of voice entries
      function getSnippets(getting) {
        // Put the results in a div
        getting.done(function (data) {
          //console.log(data);
          var globalCounter = 0;
          var tbody = document.getElementById('tbody');
          tbody.innerHTML = "";
          //for (var i = 0; i < Object.keys(data).length; i++) {
          for (var i = Object.keys(data).length; i > 0; i--) {
            var tr = "<tr>";
            tr += "<td>";
            if (i == Object.keys(data).length) {
              tr += "<b>";
            }
            tr += data[i-1].content.toString();
            if (i == Object.keys(data).length) {
              tr += "</b>";
            }
            tr + "</td></tr>";
            tbody.innerHTML += tr;
          }
        });
      };
      $("#speech").click(function(){
        var getting = $.get('/api/snippets');
        getSnippets(getting);
      });
    </script>
    <script>
      // trigger save
      $('#received').on('change','#something', function() {
        console.log("Posting Data:" + $('#something').text());
        var posting = $.post('/api/snippets', {"content": $('#something').text()});
        // Put all the results in a table
        posting.done(function (data) {
          $("#result").empty().append(data.result);
          $("#search").empty();
          var getting = $.get('/api/snippets');
          getSnippets(getting);
        });
      });
    </script>
  </body>
</html>