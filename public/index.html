<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="css/bootstrap-theme.min.css">
    <link rel="stylesheet" type="text/css" href="css/custom.css">
    <title>Voice listener and recorder with voiceCmdr</title>
</head>
<body>
<div class="container-fluid">
    <div class="panel panel-default">
        <div class="row">
            <div class="col-sm-6 col-sm-offset-1">
                <br><h2>Translator</h2>
                <h4>running in container: <span id="hostname"></span></h4><br>

                <p><strong>Say:</strong><span class="col-sm-offset-2">"Go [something]".</span></p>

                <p id="received"><strong>Received command:</strong> <span class="col-sm-offset-2"><span id="something"></span></span>
                    <!--<span><img id="listening" src="images/sound-graph-static.jpg"></span> -->
                </p>

                <p><strong>Saved:</strong> <span class="col-sm-offset-2"><span id="result"></span></span></p>

                <p id="me"><strong>Search String:</strong> <span class="col-sm-offset-2"><span id="search"></span></span></p>

                <p id="speech"><strong>Stored Translations:</strong>
                <table>
                    <tbody id="tbody"></tbody>
                </table>
                </p>
            </div>
        </div>
    </div>
</div>

<script src="js/voiceCmdr.js"></script>
<script src="js/jquery-2.1.3.min.js"></script>
<script src="js/app.js"></script>
<script>
    $(document).ready(function() {
        var g= $.get('/api/hostname');
        g.done(function(data) {
            $("#hostname").empty().append(data.hostname);
        });
    });
</script>
<script>
    $('#received').on('change', '#listening', function () {
        $("#listening").attr("src", voiceCmdr.isRecognizing() ? 'images/sound-graph-listening.gif' : 'images/sound-graph-static.jpg');
    });
    $('#me').on('search', '#search', function () {
        $("#result").empty();
        var getting = $.get('/api/snippets/content=' + $('#search').text());
        getSnippets(getting);
    });
</script>
<script>
    // table of voice entries
    function getSnippets(getting) {
        // Put the results in a div
        getting.done(function (data) {
            //console.log(data);
            var globalCounter = 0;
            var tbody = document.getElementById('tbody');
            tbody.innerHTML = "";
            //for (var i = 0; i < Object.keys(data).length; i++) {
            for (var i = Object.keys(data).length; i > 0; i--) {
                var tr = "<tr>";
                tr += "<td>";
                if (i == Object.keys(data).length) {
                    tr += "<b>";
                }
                tr += data[i - 1].content.toString();
                if (i == Object.keys(data).length) {
                    tr += "</b>";
                }
                tr + "</td></tr>";
                tbody.innerHTML += tr;
            }
        });
    }
    ;
    $("#speech").click(function () {
        var getting = $.get('/api/snippets');
        getSnippets(getting);
    });
</script>
<script>
    // trigger save
    $('#received').on('change', '#something', function () {
        console.log("Posting Data:" + $('#something').text());
        var posting = $.post('/api/snippets', {"content": $('#something').text()});
        // Put all the results in a table
        posting.done(function (data) {
            $("#result").empty().append(data.result);
            $("#search").empty();
            var getting = $.get('/api/snippets');
            getSnippets(getting);
        });
    });
</script>
</body>
</html>